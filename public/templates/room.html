<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/css/room.css">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/TimeCircles.js"></script>
    <link rel="stylesheet" href="/static/css/TimeCircles.css">
    <title>pentamath - room</title>
    </head>
    <body>
        <div id="background"></div>
        <div id="face">
          <div id="logo">
          </div>
          <div id="game">
            <div id="lobby">
              Room - Smuhackaweek
            </div>
            <div id="question">
              
            </div>
            <div id="time">
            </div>
            <div>
              <input type="tel" id="answerbox" />
            </div>
          </div>
          <div id="messagebox">
              <div id="seperator">
                <ul id="messages">
                </ul>
              </div>
              <div id="textline">
                <input type="text" id="message"/>
                <button id="send">Send</button>
              </div>
          </div>
        </div>
        <script>

            'use strict';

            function getCookie(name) {
              var value = "; " + document.cookie;
              var parts = value.split("; " + name + "=");
              if (parts.length == 2) return parts.pop().split(";").shift();
            }

            var msgList = document.getElementById("messages");
            var connection = new WebSocket('ws://{{ host }}:8000');
            var message = document.getElementById("message");
            var send = document.getElementById("send");
        

            connection.onmessage = function (msg) {
                var response = JSON.parse(msg.data);
                if (response.type === 'globalChatMessage')
                  messages.innerHTML += ("<li>" + response.from + ': ' + response.message + "</li>");
                else
                  messages.innerHTML += ("<li>" + 'SERVER: ' + response.message + "</li>");
            };

            send.addEventListener('click', function () {
                connection.send(message.value);
                document.getElementById("message").value = "";
            });
          
                document.querySelector('#textline').addEventListener('keypress', function(e){
              var key = e.which || e.keyCode;
              if(key === 13) {
                connection.send(message.value);
                document.getElementById("message").value = "";
            }
              
            });
          
          document.querySelector('#answerbox').addEventListener('keypress', function(e){
              var key = e.which || e.keyCode;
              if(key === 13) {
                $("#time").TimeCircles({ time: { Days: { show: false }, Hours: { show: false }, Minutes: { show: false }, Seconds: { text: "Seconds Left"} }}); 
                connection.send(answerbox.value);
                document.getElementById("answerbox").value = "";
            }
              
            });

            connection.onopen = function () {
                connection.send(getCookie('pentamath-uid'));
            };
          
          
        </script>
    </body>
</html>
